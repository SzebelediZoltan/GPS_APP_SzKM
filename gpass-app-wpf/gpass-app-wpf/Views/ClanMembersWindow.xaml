<Window x:Class="gpass_app_wpf.Views.ClanMembersWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="{Binding Title}" Height="680" Width="700"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize">

    <DockPanel Margin="16">

        <!-- FejlÃ©c -->
        <StackPanel DockPanel.Dock="Top" Margin="0,0,0,12">
            <TextBlock Text="{Binding Title}" FontSize="17" FontWeight="Bold" Foreground="#2c3e50"/>
            <TextBlock Text="{Binding ClanInfo}" FontSize="12" Foreground="#777" Margin="0,3,0,0"/>
            <TextBlock Text="â³ BetÃ¶ltÃ©s..." FontStyle="Italic" Foreground="#999" Margin="0,4,0,0"
                       Visibility="{Binding Loading, Converter={StaticResource BoolToVisibility}}"/>
        </StackPanel>

        <!-- â•â•â• KlÃ¡n adatok szekciÃ³ â•â•â• -->
        <Border DockPanel.Dock="Top" Background="#f7f9fc" CornerRadius="5"
                BorderBrush="#d0d7e2" BorderThickness="1" Padding="14,12" Margin="0,0,0,10">
            <StackPanel>

                <TextBlock Text="KlÃ¡n adatok" FontSize="12" FontWeight="SemiBold"
                           Foreground="#2c3e50" Margin="0,0,0,10"/>

                <!-- KÃ©t oszlop: NÃ©v | LeÃ­rÃ¡s -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="16"/>
                        <ColumnDefinition Width="2*"/>
                    </Grid.ColumnDefinitions>

                    <!-- NÃ©v -->
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="KlÃ¡n neve *" Foreground="#555" FontSize="12" Margin="0,0,0,4"/>
                        <TextBox Padding="6,5"
                                 Text="{Binding ClanName, UpdateSourceTrigger=PropertyChanged}"
                                 IsEnabled="{Binding NameSaving, Converter={StaticResource InverseBool}}"/>
                        <TextBlock Text="{Binding ClanNameError}" Foreground="#c0392b" FontSize="11"
                                   Margin="2,3,0,0"
                                   Visibility="{Binding HasClanNameError, Converter={StaticResource BoolToVisibility}}"/>
                    </StackPanel>

                    <!-- LeÃ­rÃ¡s -->
                    <StackPanel Grid.Column="2">
                        <TextBlock Text="LeÃ­rÃ¡s (opcionÃ¡lis)" Foreground="#555" FontSize="12" Margin="0,0,0,4"/>
                        <TextBox Padding="6,5" MaxLength="200"
                                 Text="{Binding ClanDescription, UpdateSourceTrigger=PropertyChanged}"
                                 IsEnabled="{Binding NameSaving, Converter={StaticResource InverseBool}}"/>
                        <TextBlock Text="{Binding ClanDescriptionError}" Foreground="#c0392b" FontSize="11"
                                   Margin="2,3,0,0"
                                   Visibility="{Binding HasClanDescriptionError, Converter={StaticResource BoolToVisibility}}"/>
                    </StackPanel>
                </Grid>

                <!-- MentÃ©s gomb + visszajelzÃ©s -->
                <Grid Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="{Binding NameSaveResult}"
                               VerticalAlignment="Center" FontSize="12" Margin="2,0,0,0"
                               Visibility="{Binding HasNameSaveResult, Converter={StaticResource BoolToVisibility}}">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#27ae60"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding NameSaveResult[0]}" Value="âš ">
                                        <Setter Property="Foreground" Value="#c0392b"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding NameSaveResult[0]}" Value="â„¹">
                                        <Setter Property="Foreground" Value="#888"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>

                    <Button Grid.Column="1" Padding="14,6"
                            Background="#2980b9" Foreground="White" FontWeight="SemiBold"
                            Command="{Binding SaveNameCommand}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="â³ " Visibility="{Binding NameSaving, Converter={StaticResource BoolToVisibility}}"/>
                            <TextBlock Text="MentÃ©s"/>
                        </StackPanel>
                    </Button>
                </Grid>

            </StackPanel>
        </Border>

        <!-- â•â•â• Tag hozzÃ¡adÃ¡sa szekciÃ³ â•â•â• -->
        <Border DockPanel.Dock="Top" Background="#f7f9fc" CornerRadius="5"
                BorderBrush="#d0d7e2" BorderThickness="1" Padding="14,12" Margin="0,0,0,10">
            <StackPanel>

                <TextBlock Text="Tag hozzÃ¡adÃ¡sa" FontSize="12" FontWeight="SemiBold"
                           Foreground="#2c3e50" Margin="0,0,0,10"/>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox Grid.Column="0" Padding="6,5" Margin="0,0,8,0"
                             Text="{Binding AddSearch, UpdateSourceTrigger=PropertyChanged}"
                             ToolTip="KeresÃ©s felhasznÃ¡lÃ³nÃ©v vagy email alapjÃ¡n"/>
                    <TextBlock Grid.Column="1" Text="â³" FontSize="14"
                               VerticalAlignment="Center" Margin="0,0,8,0"
                               Visibility="{Binding AddSearching, Converter={StaticResource BoolToVisibility}}"/>
                    <Button Grid.Column="2" Content="ï¼‹  HozzÃ¡adÃ¡s" Padding="12,5"
                            Background="#27ae60" Foreground="White" FontWeight="SemiBold"
                            Command="{Binding AddMemberCommand}"/>
                </Grid>

                <!-- TalÃ¡lati lista -->
                <ListBox x:Name="addSearchListBox"
                         ItemsSource="{Binding AddSearchResults}"
                         MaxHeight="90" Margin="0,6,0,0"
                         BorderBrush="#ccc" BorderThickness="1"
                         SelectionChanged="AddSearchListBox_SelectionChanged"
                         Visibility="{Binding AddSearchResults.Count, Converter={StaticResource IntToVisibility}}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="2,3">
                                <TextBlock Text="{Binding username}" FontWeight="SemiBold"/>
                                <TextBlock Text="  "/>
                                <TextBlock Text="{Binding email}" Foreground="#666" FontSize="11"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#e8f4fd"/>
                                    <Setter Property="Cursor" Value="Hand"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>

                <!-- KivÃ¡lasztott user -->
                <Border Background="#eafaf1" BorderBrush="#27ae60" BorderThickness="1"
                        CornerRadius="3" Padding="8,5" Margin="0,6,0,0"
                        Visibility="{Binding HasUserToAdd, Converter={StaticResource BoolToVisibility}}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="âœ” KivÃ¡lasztva: " Foreground="#27ae60" FontWeight="Bold"/>
                        <TextBlock Text="{Binding UserToAddText}" Foreground="#1e8449"/>
                    </StackPanel>
                </Border>

            </StackPanel>
        </Border>

        <!-- â•â•â• Toolbar (alul) â•â•â• -->
        <Border DockPanel.Dock="Bottom" Background="#f8f8f8" Padding="10,7"
                BorderBrush="#ddd" BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" VerticalAlignment="Center" Foreground="#555"
                           Text="{Binding Members.Count, StringFormat='Ã–sszesen: {0} tag'}"/>

                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Content="ðŸ‘‘  VezetÅ‘ kinevezÃ©se" Padding="10,5" Margin="0,0,8,0"
                            Background="#e67e22" Foreground="White"
                            Command="{Binding ChangeLeaderCommand}"
                            ToolTip="KijelÃ¶lt tag legyen az Ãºj vezetÅ‘"/>
                    <Button Content="âœ•  Tag eltÃ¡volÃ­tÃ¡sa" Padding="10,5"
                            Background="#e74c3c" Foreground="White"
                            Command="{Binding RemoveMemberCommand}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- â•â•â• Tagok tÃ¡blÃ¡zat â•â•â• -->
        <DataGrid ItemsSource="{Binding Members}"
                  SelectedItem="{Binding SelectedMember, Mode=TwoWay}"
                  AutoGenerateColumns="False" IsReadOnly="True" CanUserAddRows="False"
                  GridLinesVisibility="Horizontal" AlternatingRowBackground="#fafafa"
                  BorderBrush="#d0d7e2" BorderThickness="1">
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding is_leader}" Value="True">
                            <Setter Property="Background" Value="#fff9e6"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>
            <DataGrid.Columns>
                <DataGridTextColumn Header="User ID"      Binding="{Binding user_id}"        Width="70"/>
                <DataGridTextColumn Header="FelhasznÃ¡lÃ³"  Binding="{Binding display_name}"   Width="150"/>
                <DataGridTextColumn Header="Email"        Binding="{Binding display_email}"  Width="*"/>
                <DataGridTextColumn Header="Szerep"       Binding="{Binding role_label}"     Width="80"/>
                <DataGridTextColumn Header="Csatlakozott" Binding="{Binding joined_at, Converter={StaticResource IsoDate}}" Width="135"/>
            </DataGrid.Columns>
        </DataGrid>

    </DockPanel>
</Window>
