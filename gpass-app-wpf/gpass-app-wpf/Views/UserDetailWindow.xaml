<Window x:Class="gpass_app_wpf.Views.UserDetailWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:gpass_app_wpf.ViewModels"
        Title="{Binding Title}" Height="580" Width="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize">

    <DockPanel Margin="16">

        <!-- FejlÃ©c -->
        <StackPanel DockPanel.Dock="Top" Margin="0,0,0,10">
            <TextBlock Text="{Binding Title}" FontSize="18" FontWeight="Bold" Foreground="#2c3e50"/>
            <TextBlock Text="{Binding UserInfo}" FontSize="12" Foreground="#777" Margin="0,3,0,0"/>
            <TextBlock Text="â³ BetÃ¶ltÃ©s..." FontStyle="Italic" Foreground="#999" Margin="0,4,0,0"
                       Visibility="{Binding Loading, Converter={StaticResource BoolToVisibility}}"/>
        </StackPanel>

        <!-- HibaÃ¼zenetek -->
        <Border DockPanel.Dock="Top"
                Background="#fff3cd" BorderBrush="#ffc107" BorderThickness="1"
                CornerRadius="4" Padding="8,6" Margin="0,0,0,8"
                Visibility="{Binding HasErrors, Converter={StaticResource BoolToVisibility}}">
            <TextBlock Text="{Binding Errors}" Foreground="#856404" FontSize="11" TextWrapping="Wrap"/>
        </Border>

        <TabControl>

            <!-- TRIPEK -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ—º Tripek  "/>
                        <TextBlock Text="{Binding Trips.Count}" FontWeight="Bold"/>
                        <TextBlock Text=" db"/>
                    </StackPanel>
                </TabItem.Header>
                <DockPanel>
                    <Border DockPanel.Dock="Bottom" Background="#f8f8f8" Padding="8,6" BorderBrush="#ddd" BorderThickness="0,1,0,0">
                        <StackPanel Orientation="Horizontal">
                            <Button Content="âœ•  Trip tÃ¶rlÃ©se" Padding="10,5" Background="#e74c3c" Foreground="White"
                                    Command="{Binding DeleteTripCommand}"/>
                        </StackPanel>
                    </Border>
                    <DataGrid ItemsSource="{Binding Trips}"
                              SelectedItem="{Binding SelectedTrip, Mode=TwoWay}"
                              AutoGenerateColumns="False" IsReadOnly="True" CanUserAddRows="False"
                              GridLinesVisibility="Horizontal" AlternatingRowBackground="#fafafa">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID"         Binding="{Binding id}"          Width="60"/>
                            <DataGridTextColumn Header="Trip #"     Binding="{Binding trip_number}" Width="80"/>
                            <DataGridTextColumn Header="LÃ©trehozva" Binding="{Binding created_at, Converter={StaticResource IsoDate}}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>

            <!-- MARKEREK -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“ Markerek  "/>
                        <TextBlock Text="{Binding Markers.Count}" FontWeight="Bold"/>
                        <TextBlock Text=" db"/>
                    </StackPanel>
                </TabItem.Header>
                <DockPanel>

                    <!-- SzerkesztÅ‘ panel (alul) -->
                    <Border DockPanel.Dock="Bottom" Background="#f7f9fc"
                            BorderBrush="#d0d7e2" BorderThickness="0,1,0,0" Padding="10,8">
                        <StackPanel>

                            <!-- SzerkesztÃ©s form â€” csak ha van kijelÃ¶lve -->
                            <Grid Visibility="{Binding HasSelectedMarker, Converter={StaticResource BoolToVisibility}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="16"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="8"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" Text="TÃ­pus:" VerticalAlignment="Center"
                                           Foreground="#555" Margin="0,0,6,0"/>
                                <ComboBox Grid.Column="1" Padding="5,4"
                                          ItemsSource="{Binding Source={x:Static vm:UserDetailViewModel.AllowedMarkerTypes}}"
                                          SelectedItem="{Binding EditMarkerType, Mode=TwoWay}"
                                          IsEnabled="{Binding MarkerSaving, Converter={StaticResource InverseBool}}"/>

                                <TextBlock Grid.Column="3" Text="Pont:" VerticalAlignment="Center"
                                           Foreground="#555" Margin="0,0,6,0"/>
                                <TextBox Grid.Column="4" Padding="5,4"
                                         Text="{Binding EditMarkerScore, UpdateSourceTrigger=PropertyChanged}"
                                         IsEnabled="{Binding MarkerSaving, Converter={StaticResource InverseBool}}"/>

                                <!-- VisszajelzÃ©s / hiba -->
                                <TextBlock Grid.Column="5" VerticalAlignment="Center" FontSize="11"
                                           Margin="10,0,0,0" TextWrapping="NoWrap"
                                           Visibility="{Binding HasMarkerEditError, Converter={StaticResource BoolToVisibility}}"
                                           Text="{Binding MarkerEditError}" Foreground="#c0392b"/>
                                <TextBlock Grid.Column="5" VerticalAlignment="Center" FontSize="11"
                                           Margin="10,0,0,0" TextWrapping="NoWrap"
                                           Visibility="{Binding HasMarkerEditResult, Converter={StaticResource BoolToVisibility}}">
                                    <TextBlock.Text><Binding Path="MarkerEditResult"/></TextBlock.Text>
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#27ae60"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding MarkerEditResult[0]}" Value="âš ">
                                                    <Setter Property="Foreground" Value="#c0392b"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>

                                <!-- Gombok -->
                                <Button Grid.Column="6" Padding="12,5"
                                        Background="#2980b9" Foreground="White" FontWeight="SemiBold"
                                        Command="{Binding EditMarkerCommand}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="â³ " Visibility="{Binding MarkerSaving, Converter={StaticResource BoolToVisibility}}"/>
                                        <TextBlock Text="âœŽ  MentÃ©s"/>
                                    </StackPanel>
                                </Button>
                                <Button Grid.Column="8" Padding="12,5"
                                        Background="#e74c3c" Foreground="White" FontWeight="SemiBold"
                                        Command="{Binding DeleteMarkerCommand}">
                                    <TextBlock Text="âœ•  TÃ¶rlÃ©s"/>
                                </Button>
                            </Grid>

                            <!-- Ha nincs kijelÃ¶lve -->
                            <TextBlock Text="JelÃ¶lj ki egy markert a szerkesztÃ©shez vagy tÃ¶rlÃ©shez."
                                       Foreground="#aaa" FontStyle="Italic" FontSize="12"
                                       Visibility="{Binding HasSelectedMarker, Converter={StaticResource InverseBool}}"/>

                        </StackPanel>
                    </Border>

                    <DataGrid ItemsSource="{Binding Markers}"
                              SelectedItem="{Binding SelectedMarker, Mode=TwoWay}"
                              AutoGenerateColumns="False" IsReadOnly="True" CanUserAddRows="False"
                              GridLinesVisibility="Horizontal" AlternatingRowBackground="#fafafa">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID"         Binding="{Binding id}"          Width="50"/>
                            <DataGridTextColumn Header="TÃ­pus"      Binding="{Binding marker_type}" Width="120"/>
                            <DataGridTextColumn Header="Pont"       Binding="{Binding score}"       Width="60"/>
                            <DataGridTextColumn Header="Lat"        Binding="{Binding lat}"         Width="95"/>
                            <DataGridTextColumn Header="Lng"        Binding="{Binding lng}"         Width="95"/>
                            <DataGridTextColumn Header="LÃ©trehozva" Binding="{Binding created_at, Converter={StaticResource IsoDate}}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>

            <!-- BARÃTOK -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ¤ BarÃ¡tok  "/>
                        <TextBlock Text="{Binding Friends.Count}" FontWeight="Bold"/>
                        <TextBlock Text=" db"/>
                    </StackPanel>
                </TabItem.Header>
                <DockPanel>
                    <Border DockPanel.Dock="Bottom" Background="#f8f8f8" Padding="8,6" BorderBrush="#ddd" BorderThickness="0,1,0,0">
                        <StackPanel Orientation="Horizontal">
                            <Button Content="ðŸ”„  StÃ¡tusz vÃ¡ltÃ¡s" Padding="10,5" Margin="0,0,8,0"
                                    Background="#2980b9" Foreground="White"
                                    Command="{Binding ToggleFriendCommand}"/>
                            <Button Content="âœ•  TÃ¶rlÃ©s" Padding="10,5" Background="#e74c3c" Foreground="White"
                                    Command="{Binding DeleteFriendCommand}"/>
                        </StackPanel>
                    </Border>
                    <DataGrid ItemsSource="{Binding Friends}"
                              SelectedItem="{Binding SelectedFriend, Mode=TwoWay}"
                              AutoGenerateColumns="False" IsReadOnly="True" CanUserAddRows="False"
                              GridLinesVisibility="Horizontal" AlternatingRowBackground="#fafafa">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID"         Binding="{Binding id}"          Width="50"/>
                            <DataGridTextColumn Header="KÃ¼ldÅ‘ ID"   Binding="{Binding sender_id}"   Width="85"/>
                            <DataGridTextColumn Header="FogadÃ³ ID"  Binding="{Binding receiver_id}" Width="85"/>
                            <DataGridTextColumn Header="Ãllapot"    Binding="{Binding status}"      Width="85"/>
                            <DataGridTextColumn Header="LÃ©trehozva" Binding="{Binding created_at, Converter={StaticResource IsoDate}}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>

            <!-- CLÃNOK -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ›¡ ClÃ¡nok  "/>
                        <TextBlock Text="{Binding Clans.Count}" FontWeight="Bold"/>
                        <TextBlock Text=" db"/>
                    </StackPanel>
                </TabItem.Header>
                <DataGrid ItemsSource="{Binding Clans}" AutoGenerateColumns="False"
                          IsReadOnly="True" CanUserAddRows="False"
                          GridLinesVisibility="Horizontal" AlternatingRowBackground="#fafafa">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ClÃ¡n ID"     Binding="{Binding clan_id}"   Width="75"/>
                        <DataGridTextColumn Header="ClÃ¡n neve"   Binding="{Binding clan_name}" Width="160"/>
                        <DataGridTextColumn Header="Csatlakozott" Binding="{Binding joined_at, Converter={StaticResource IsoDate}}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <!-- TRIP PONTOK -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“Œ Trip pontok  "/>
                        <TextBlock Text="{Binding TripPoints.Count}" FontWeight="Bold"/>
                        <TextBlock Text=" db"/>
                    </StackPanel>
                </TabItem.Header>
                <DataGrid ItemsSource="{Binding TripPoints}" AutoGenerateColumns="False"
                          IsReadOnly="True" CanUserAddRows="False"
                          GridLinesVisibility="Horizontal" AlternatingRowBackground="#fafafa">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID"       Binding="{Binding id}"          Width="55"/>
                        <DataGridTextColumn Header="Trip ID"  Binding="{Binding trip_id}"     Width="75"/>
                        <DataGridTextColumn Header="Lat"      Binding="{Binding lat}"         Width="110"/>
                        <DataGridTextColumn Header="Lng"      Binding="{Binding lng}"         Width="110"/>
                        <DataGridTextColumn Header="RÃ¶gzÃ­tve" Binding="{Binding recorded_at, Converter={StaticResource IsoDate}}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

        </TabControl>
    </DockPanel>
</Window>
